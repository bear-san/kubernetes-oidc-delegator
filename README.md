# Kubernetes OIDC Delegator

An API server that provides JWKs endpoints for validating ServiceAccount tokens.

## Overview

This project provides an API to enable external validation of ServiceAccount tokens issued within a Kubernetes cluster. It exposes OpenID Configuration and JWKs endpoints using signing keys generated by Cluster API.

## Features

- OpenID Configuration endpoint (`/.well-known/openid-configuration`)
- JWKs endpoint (`/keys`)
- Customizable namespace formatting (Prefix/Suffix)
- Health check endpoint

## Prerequisites

- Access to a Kubernetes cluster
- Secret named `[Cluster Name]-sa` generated by Cluster API
- Go 1.24 or higher

## Build

```bash
go build -o kubernetes-oidc-delegator cmd/server/main.go
```

Build Docker image:
```bash
docker build -t kubernetes-oidc-delegator:latest .
```

## Run

### Local Execution
```bash
./kubernetes-oidc-delegator --server-host https://oidc-delegator.example.com --port 8080
```

### Options
- `--server-host`: Server host URL (required)
- `--port`: Server port (default: 8080)
- `--namespace-prefix`: Namespace prefix
- `--namespace-suffix`: Namespace suffix

## Deploy to Kubernetes

```bash
kubectl apply -f manifests/
```

## Endpoints

### OpenID Configuration
```
GET /{projectID}/{clusterName}/.well-known/openid-configuration
```

### JWKs
```
GET /{projectID}/{clusterName}/keys
```

### Health Check
```
GET /health
```
## License

MIT
